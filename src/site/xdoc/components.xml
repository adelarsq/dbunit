<?xml version="1.0" encoding="ISO-8859-1"?>
<document><properties><title>Core Components</title></properties><body><section>
	 
      <h3>Core Components</h3>
      <p>This document attemps to give you an overview of the core classes that make up DbUnit. 
      Following are the core interfaces or abstract classes:
      
      <table border="1">
        <tr> 
          <th>Class</th>
          <th>Description</th>
        </tr>
        <tr> 
          <td><a href="#databaseconnection">IDatabaseConnection</a></td>
          <td>Interface representing a DbUnit connection to a database.</td>
        </tr>
        <tr> 
          <td><a href="#dataset">IDataSet</a></td>
          <td>Interface representing a collection of tables.</td>
        </tr>
        <tr> 
          <td><a href="#databaseoperation">DatabaseOperation</a></td>
          <td>Abstract class representing an operation performed on the database before and after each test.</td>
        </tr>
       </table>
      </p>

      <h3><a name="databaseconnection">IDatabaseConnection</a></h3>
      <p>The <a href="apidocs/org/dbunit/database/IDatabaseConnection.html">IDatabaseConnection</a> interface represents  
        a DbUnit connection to a database. 
        
      <table border="1">
        <tr> 
          <th>Class</th>
          <th>Description</th>
        </tr>
        <tr> 
          <td><a href="apidocs/org/dbunit/database/DatabaseConnection.html">DatabaseConnection</a></td>
          <td>Wraps a JDBC connection.</td>
        </tr>
        <tr> 
          <td><a href="apidocs/org/dbunit/database/DatabaseDataSourceConnection.html">DatabaseDataSourceConnection</a></td>
          <td>Wraps a JDBC DataSource.</td>
        </tr>
       </table>
      </p>
      
      <h3><a name="dataset">IDataSet</a></h3>
      <p>The <a href="apidocs/org/dbunit/dataset/IDataSet.html">IDataSet</a> interface represents is a collection 
        of tables. This is the primary abstraction used by DbUnit to manipulate tabular data. 
</p>
      <p>Most commonly used implemetations:       
      <table border="1">
        <tr> 
          <th>Implementation</th>
          <th>Description</th>
        </tr>
        <tr> 
          <td><a name="flatxmldataset" href="apidocs/org/dbunit/dataset/xml/FlatXmlDataSet.html">FlatXmlDataSet</a></td>
          <td>      
       Reads and writes flat XML dataset document. Each XML element corresponds to a table row. 
        Each XML element name corresponds to a table name. The XML attributes 
        correspond to table columns.<br/>
      Flat XML dataset document sample:
      <source><![CDATA[
<!DOCTYPE dataset SYSTEM "my-dataset.dtd">
<dataset>
    <TEST_TABLE COL0="row 0 col 0" 
                COL1="row 0 col 1"
                COL2="row 0 col 2"/> 
    <TEST_TABLE COL1="row 1 col 1"/>
    <SECOND_TABLE COL0="row 0 col 0" 
                  COL1="row 0 col 1" />
    <EMPTY_TABLE/>
</dataset>]]></source>
      <br/>
      To specify null values, omit corresponding attribute. 
      In the above example, missing COL0 and COL2 attributes of TEST_TABLE second row represents null values.
      <br/>
      Table metadata is deduced from the first row of each table. <b>Beware you may get a NoSuchColumnException 
      if the first row of a table has one or more null values.</b>
      Because of that, this is highly recommended to use DTD. DbUnit will use the 
      columns declared in the DTD as table metadata. DbUnit only support external system URI. 
      The URI can be absolute or relative.
      <br/>
      Another way to cope with this problem is to use the <a href= "#replacementdataset">ReplacementDataSet</a>.
     
</td>
        </tr>
        <tr> 
          <td><a name="xmldataset" href="apidocs/org/dbunit/dataset/xml/XmlDataSet.html">XmlDataSet</a></td>
          <td>
      Reads and writes original XML dataset document. This format 
        is very verbose and must conform to the following DTD:
      <source><![CDATA[
<?xml version="1.0" encoding="UTF-8"?>
<!ELEMENT dataset (table+)>
<!ELEMENT table (column*, row*)>
<!ATTLIST table
    name CDATA #REQUIRED
>
<!ELEMENT column (#PCDATA)>
<!ELEMENT row (value | null | none)*>
<!ELEMENT value (#PCDATA)>
<!ELEMENT null EMPTY>
]]></source>
      <br/>
      <a name="originalxmlsample">XML dataset document sample:</a>
      <source><![CDATA[
<!DOCTYPE dataset SYSTEM "dataset.dtd">
<dataset>
    <table name="TEST_TABLE">
        <column>COL0</column>
        <column>COL1</column>
        <column>COL2</column>
        <row>
            <value>row 0 col 0</value>
            <value>row 0 col 1</value>
            <value>row 0 col 2</value>
        </row>
        <row>
            <null/>
            <value>row 1 col 1</value>
            <null/>
        </row>
    </table>
    <table name="SECOND_TABLE">
        <column>COLUMN0</column>
        <column>COLUMN1</column>
        <row>
            <value>row 0 col 0</value>
            <value>row 0 col 1</value>
        </row>
    </table>
    <table name='EMPTY_TABLE'>
        <column>COLUMN0</column>
        <column>COLUMN1</column>
    </table>
</dataset>]]></source>
      <br/>
          </td>
        </tr>
        <tr> 
          <td><a name="streamingdataset" href="apidocs/org/dbunit/database/StreamingDataSet.html">StreamingDataSet</a></td>
          <td>Consumes a producer and expose its content as a dataset. Provides cursor like forward only access to it and only keeps the active row in memory. Can be used with FlatXmlProducer and XmlProvider.
<br/>
This is a very efficient way to load XML dataset document when working with forward only database operations (UPDATE, INSERT, REFRESH).
<br/>
Following sample shows how to load a flat XML dataset with the StreamingDataSet: 
<source>
    IDataSetProducer producer = new FlatXmlProducer(
            new InputSource("dataset.xml"));
    IDataSet dataSet = new StreamingDataSet(producer);
</source>
</td>
        </tr>
        <tr> 
          <td><a name="databasedataset" href="apidocs/org/dbunit/database/DatabaseDataSet.html">DatabaseDataSet</a></td>
          <td>Adapter that provides access 
      to a database instance as a dataset. This class is not usually instantiated 
      directly but from the factory method <code>IDatabaseConnection.createDataSet()</code>.</td>
        </tr>
        <tr> 
          <td><a name="querydataset" href="apidocs/org/dbunit/database/QueryDataSet.html">QueryDataSet</a></td>
          <td>Holds collection of tables resulting from database queries.
          <br/>
          Following sample snippet creates a dataset containing two tables: FOO, resulting from specified query and BAR, resulting from generated query "SELECT * FROM BAR".
<source>
    QueryDataSet dataSet = new QueryDataSet(connection);
    dataSet.addTable("FOO", "SELECT * FROM TABLE WHERE COL='VALUE'");
    dataSet.addTable("BAR");
</source>

          </td>
        </tr>
        <tr> 
          <td><a name="defaultdataset" href="apidocs/org/dbunit/dataset/DefaultDataSet.html">DefaultDataSet</a></td>
          <td>Uses to create datasets       programmatically.</td>
        </tr>
        <tr> 
          <td><a name="compositedataset" href="apidocs/org/dbunit/dataset/CompositeDataSet.html">CompositeDataSet</a></td>
          <td>Combines multiple datasets 
      into a single logical dataset.</td>
        </tr>
        <tr> 
          <td><a name="filtereddataset" href="apidocs/org/dbunit/dataset/FilteredDataSet.html">FilteredDataSet</a></td>
          <td>Decorator that exposes only some tables from decorated dataset. Can be used with different filtering strategies. Some strategies can include/exclude tables without altering their order while others expose tables with a different order.
                <table border="1">
        <tr> 
          <th>Strategy</th>
          <th>Description</th>
        </tr>
        <tr> 
          <td>IncludeTableFilter</td>
          <td>Exposes only matching tables pattern without modifying the original table order. Support wildcards. </td>
        </tr>

        <tr> 
          <td>ExcludeTableFilter </td>
          <td>Hides matching tables pattern without modifying the original table order. Support wildcards.</td>
        </tr>
        <tr> 
          <td>SequenceTableFilter </td>
          <td>Exposes a configured table sequence and can be used to reorder dataset table. This is the original filtering strategy from DbUnit 1.x. </td>
        </tr>
        <tr> 
          <td>DatabaseSequenceFilter</td>
          <td> Automatically determine the tables order using foreign/exported keys information. 
          This strategy is vendor 
          independent and should work with any JDBC driver that implement the 
          <code>DatabaseMetaData.getExportedKeys()</code> method. 
          <br/>
		Support simple multi-level dependency like this:
<source>
   A
  / \
 B   C
    / \
   D   E
</source>
</td>
        </tr>
</table>

          </td>
        </tr>
        <tr> 
          <td><a name="xlsdataset" href="apidocs/org/dbunit/dataset/excel/XlsDataSet.html">XlsDataSet</a></td>
          <td>Read and writes MS Excel dataset documents. Each
  sheet represents a table. The first row of a sheet defines the columns names
  and remaining rows contains the data.</td>
        </tr>
        <tr> 
          <td><a name= "replacementdataset" href="apidocs/org/dbunit/dataset/ReplacementDataSet.html">ReplacementDataSet</a></td>
          <td>Decorator that replaces placeholder objects from the decorated dataset with replacement objects. Substring substitution is also possible.
          <br/>
Interestingly this provides a new way to specify null values in flat XML datasets. For example you can use a placeholder value, like "[NULL]" in your flat XML dataset and replace it with <code>null</code> at runtime.

<source><![CDATA[
<?xml version="1.0"?>
<dataset>
    <TEST_TABLE COL0="row 0 col 0" 
                COL1="[null]"/> 
    <TEST_TABLE COL1="row 1 col 0"
                COL2="row 1 col 1"/> 
</dataset>]]></source>
          <br/>
Loading the flat XML dataset:
<source><![CDATA[
ReplacementDataSet dataSet = new ReplacementDataSet(
        new FlatXmlDataSet(…)); 
dataSet.addReplacementObject("[NULL]", null);]]></source>
          <br/>
 </td>
        </tr>
      </table>
      </p>
      <h3><a name="databaseoperation">DatabaseOperation</a></h3>
      <p><a href="apidocs/org/dbunit/operation/DatabaseOperation.html">DatabaseOperation</a> is an abstract class that represents an operation performed on the database before and after each test. </p>
      <p>The two most usefull operations are <a href="#refresh">REFRESH</a> and 
        <a href="#cleanInsert">CLEAN_INSERT</a>. They 
        are the ones you will deal usualy with. They represent two 
        testing strategies with different benefits and tradeoffs. </p>

      <table border="1">
        <tr> 
          <th>Operation</th>
          <th>Description</th>
        </tr>
        <tr> 
          <td><a href="apidocs/org/dbunit/operation/UpdateOperation.html">DatabaseOperation.UPDATE</a></td>
          <td>This operation updates the database from the dataset contents. This operation 
      assumes that table data already exists in the target database and fails 
      if this is not the case.</td>
        </tr>
        <tr> 
          <td><a name="insert" href="apidocs/org/dbunit/operation/InsertOperation.html">DatabaseOperation.INSERT</a></td>
          <td>This operation inserts the dataset contents into the database. This operation 
      assumes that table data does not exist in the target database and fails 
      if this is not the case. To prevent problems with foreign keys, tables must 
      be sequenced appropriately in the dataset.</td>
        </tr>
        <tr> 
          <td><a name="delete" href="apidocs/org/dbunit/operation/DeleteOperation.html">DatabaseOperation.DELETE</a></td>
          <td>This operation deletes only the dataset contents from the database. This 
      operation does not delete the entire table contents but only data that are 
      present in the dataset.</td>
        </tr>
        <tr> 
          <td><a name="deleteall" href="apidocs/org/dbunit/operation/DeleteAllOperation.html">DatabaseOperation.DELETE_ALL</a></td>
          <td>Deletes all rows of tables present in the specified dataset. If the dataset does not contains a particular table, but that table exists in the database, the database table is not affected. Table are truncated in reverse sequence.</td>
        </tr>
        <tr> 
          <td><a name="truncate" href="apidocs/org/dbunit/operation/TruncateTableOperation.html">DatabaseOperation.TRUNCATE</a></td>
          <td>Truncate tables present in the specified dataset. If the dataset does not contains a particular table, but that table exists in the database, the database table is not affected. Table are truncated in reverse sequence. 

</td>
        </tr>
        <tr> 
          <td><a name="refresh" href="apidocs/org/dbunit/operation/RefreshOperation.html">DatabaseOperation.REFRESH</a></td>
          <td>This operation literally refreshes dataset contents into the target database. 
      This means that data of existing rows are updated and non-existing row get 
      inserted. Any rows which exist in the database but not in dataset stay unaffected. 
      This approach is more appropriate for tests that assume other data may exist 
      in the database.<br/>
      if they are correctly written, tests using this strategy can even be performed 
      on a populated database like a copy of a production database.</td>
        </tr>
        <tr> 
          <td><a name="cleanInsert">DatabaseOperation.CLEAN_INSERT</a></td>
          <td>This composite operation performs a <a href="#deleteall">DELETE_ALL</a> operation followed by an 
      <a href="#insert">INSERT</a> operation. This is the safest approach to ensure that the database 
      is in a known state. This is appropriate for tests that require the database 
      to only contain a specific set of data.</td>
        </tr>
        <tr> 
          <td>DatabaseOperation.NONE</td>
          <td>Empty operation that does absolutely nothing.</td>
        </tr>
        <tr> 
          <td><a href="apidocs/org/dbunit/operation/CompositeOperation.html">CompositeOperation</a></td>
          <td>This operation combines multiple operations into a single one.</td>
        </tr>
        <tr> 
          <td><a href="apidocs/org/dbunit/operation/TransactionOperation.html">TransactionOperation</a></td>
          <td>This operation decorates an operation and executes it within the context 
        of a transaction.</td>
        </tr>
        <tr> 
          <td><a name="InsertIdentityOperation" href="apidocs/org/dbunit/ext/mssql/InsertIdentityOperation.html">IdentityInsertOperation</a></td>
          <td>This operation decorates an insert operation and disables the MS SQL 
        Server automatic identifier generation (IDENTITY) during its execution. 
        Use following constants InsertIdentityOperation.INSERT, InsertIdentityOperation.CLEAN_INSERT 
        or InsertIdentityOperation.REFRESH instead of those defined in DatabaseOperation.</td>
        </tr>
      </table>

      </section></body></document>
